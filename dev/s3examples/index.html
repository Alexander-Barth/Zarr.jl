<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Accessing cloud data Examples · Zarr.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Zarr.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../tutorial/">Tutorial</a></li><li><a class="tocitem" href="../reference/">Function Reference</a></li><li><a class="tocitem" href="../storage/">Storage Backends</a></li><li class="is-active"><a class="tocitem" href>Accessing cloud data Examples</a><ul class="internal"><li><a class="tocitem" href="#Accessing-data-on-Amazon-S3-1"><span>Accessing data on Amazon S3</span></a></li><li><a class="tocitem" href="#Accessing-CMIP6-data-on-GCS-1"><span>Accessing CMIP6 data on GCS</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Accessing cloud data Examples</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Accessing cloud data Examples</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/meggart/Zarr.jl/blob/master/docs/src/s3examples.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Some-examples-on-how-to-access-public-S3-datasets-1"><a class="docs-heading-anchor" href="#Some-examples-on-how-to-access-public-S3-datasets-1">Some examples on how to access public S3 datasets</a><a class="docs-heading-anchor-permalink" href="#Some-examples-on-how-to-access-public-S3-datasets-1" title="Permalink"></a></h1><p>With this package it is possible to access public datasets that are hosted remotely on a s3-compatible cloud store. Here we provide examples on how to read data from commonly used datasets.</p><h2 id="Accessing-data-on-Amazon-S3-1"><a class="docs-heading-anchor" href="#Accessing-data-on-Amazon-S3-1">Accessing data on Amazon S3</a><a class="docs-heading-anchor-permalink" href="#Accessing-data-on-Amazon-S3-1" title="Permalink"></a></h2><p>First we show how to access the zarr-demo bucket on AWS S3. We have to setup a AWS configuration first, for options look at the documentation of <a href="https://github.com/JuliaCloud/AWSCore.jl">AWSCore.jl</a>. If you don&#39;t have an account, you can access the dataset without credentials as follows:</p><pre><code class="language-julia">using Zarr, AWSCore
region = &quot;eu-west-2&quot;
aws = aws_config(creds=nothing, region = region)</code></pre><pre><code class="language-none">Dict{Symbol,Any} with 2 entries:
  :creds  =&gt; nothing
  :region =&gt; &quot;eu-west-2&quot;</code></pre><p>Then we can create an S3Store based on the known bucket name and store base path.</p><pre><code class="language-julia">bucket = &quot;zarr-demo&quot;
store = &quot;store/foo/bar&quot;
S3 = S3Store(bucket, store, aws = aws)</code></pre><pre><code class="language-none">S3 Object Storage</code></pre><p>Let&#39;s find out what is actually stored in there:</p><pre><code class="language-julia">z = zopen(S3)</code></pre><pre><code class="language-none">ZarrGroup at S3 Object Storage
Variables: baz </code></pre><p>So we see that the store points to a zarr group with a single variable <code>baz</code>.</p><pre><code class="language-julia">v = z[&quot;baz&quot;]</code></pre><pre><code class="language-none">ZArray{Zarr.ASCIIChar} of size 21</code></pre><p>The variable seems to contain an ASCIIString.</p><pre><code class="language-julia">String(v[:])</code></pre><pre><code class="language-none">&quot;Hello from the cloud!&quot;</code></pre><h2 id="Accessing-CMIP6-data-on-GCS-1"><a class="docs-heading-anchor" href="#Accessing-CMIP6-data-on-GCS-1">Accessing CMIP6 data on GCS</a><a class="docs-heading-anchor-permalink" href="#Accessing-CMIP6-data-on-GCS-1" title="Permalink"></a></h2><p>GCS is hosting a subset of the <a href="https://pcmdi.llnl.gov/CMIP6/">CMIP6</a> climate model ensemble runs. The data is stored in zarr format and accessible using this package. We first have to create an anonymous config again to access the data:</p><pre><code class="language-julia">using Zarr, AWSCore
aws_google = AWSCore.aws_config(creds=nothing, region=&quot;&quot;, service_host=&quot;googleapis.com&quot;, service_name=&quot;storage&quot;)
cmip6_base = S3Store(&quot;cmip6&quot;,&quot;&quot;, aws = aws_google, listversion=1)
keys(cmip6_base)</code></pre><pre><code class="language-none">8-element Array{String,1}:
 &quot;cmip6-zarr-consolidated-stores-noQC.csv&quot;
 &quot;cmip6-zarr-consolidated-stores.csv&quot;     
 &quot;cmip6.csv&quot;                              
 &quot;pangeo-cmip3.csv&quot;                       
 &quot;pangeo-cmip3.json&quot;                      
 &quot;pangeo-cmip5.csv&quot;                       
 &quot;pangeo-cmip5.json&quot;                      
 &quot;pangeo-cmip6.json&quot;                      </code></pre><p>Looks like there is some configuration stored in these csv files. So let&#39;s read it into a DatFrame:</p><pre><code class="language-julia">using DataFrames, CSV
overview = CSV.read(IOBuffer(cmip6_base[&quot;cmip6-zarr-consolidated-stores.csv&quot;]))</code></pre><pre><code class="language-none">138786×10 DataFrame. Omitted printing of 6 columns
│ Row    │ activity_id │ institution_id │ source_id  │ experiment_id │
│        │ String      │ String         │ String     │ String        │
├────────┼─────────────┼────────────────┼────────────┼───────────────┤
│ 1      │ AerChemMIP  │ BCC            │ BCC-ESM1   │ piClim-CH4    │
│ 2      │ AerChemMIP  │ BCC            │ BCC-ESM1   │ piClim-CH4    │
│ 3      │ AerChemMIP  │ BCC            │ BCC-ESM1   │ piClim-CH4    │
│ 4      │ AerChemMIP  │ BCC            │ BCC-ESM1   │ piClim-CH4    │
│ 5      │ AerChemMIP  │ BCC            │ BCC-ESM1   │ piClim-CH4    │
│ 6      │ AerChemMIP  │ BCC            │ BCC-ESM1   │ piClim-CH4    │
│ 7      │ AerChemMIP  │ BCC            │ BCC-ESM1   │ piClim-CH4    │
⋮
│ 138779 │ ScenarioMIP │ UA             │ MCM-UA-1-0 │ ssp585        │
│ 138780 │ ScenarioMIP │ UA             │ MCM-UA-1-0 │ ssp585        │
│ 138781 │ ScenarioMIP │ UA             │ MCM-UA-1-0 │ ssp585        │
│ 138782 │ ScenarioMIP │ UA             │ MCM-UA-1-0 │ ssp585        │
│ 138783 │ ScenarioMIP │ UA             │ MCM-UA-1-0 │ ssp585        │
│ 138784 │ ScenarioMIP │ UA             │ MCM-UA-1-0 │ ssp585        │
│ 138785 │ ScenarioMIP │ UA             │ MCM-UA-1-0 │ ssp585        │
│ 138786 │ ScenarioMIP │ UA             │ MCM-UA-1-0 │ ssp585        │</code></pre><p>These columns contain the path to the store as well, so after some subsetting we can access the member run we are interested in:</p><pre><code class="language-julia">store = filter(overview) do row
  row.activity_id == &quot;ScenarioMIP&quot; &amp;&amp; row.institution_id==&quot;DKRZ&quot; &amp;&amp; row.variable_id==&quot;tas&quot; &amp;&amp; row.experiment_id==&quot;ssp585&quot;
end
store.zstore[1]</code></pre><pre><code class="language-none">&quot;gs://cmip6/ScenarioMIP/DKRZ/MPI-ESM1-2-HR/ssp585/r1i1p1f1/Amon/tas/gn/&quot;</code></pre><p>So we can access the dataset and read some data from it:</p><pre><code class="language-julia">s = S3Store(&quot;cmip6&quot;,&quot;ScenarioMIP/DKRZ/MPI-ESM1-2-HR/ssp585/r1i1p1f1/Amon/tas/gn/&quot;, aws=aws_google, listversion=1)
g = zopen(s)</code></pre><p>You can access the meta-information through <code>g.attrs</code> or for example read the first time slice through</p><pre><code class="language-julia">g[&quot;tas&quot;][:,:,1]</code></pre><pre><code class="language-none">384×192 reshape(::Array{Union{Missing, Float32},3}, 384, 192) with eltype Union{Missing, Float32}:
 244.27   245.276  245.186  245.419  …  252.782  252.852  252.672  252.667
 244.284  245.223  245.122  245.497     252.833  252.88   252.686  252.682
 244.309  245.139  245.003  245.422     252.85   252.895  252.704  252.663
 244.297  245.104  244.954  245.272     252.84   252.872  252.727  252.69
 244.352  245.055  244.835  245.182     252.858  252.895  252.739  252.69
 244.358  245.001  244.825  245.079  …  252.79   252.926  252.77   252.7  
 244.34   244.924  244.79   245.104     252.778  252.907  252.768  252.672
 244.348  244.87   244.737  245.112     252.756  252.928  252.755  252.712
 244.339  244.803  244.684  245.223     252.741  252.911  252.78   252.706
 244.383  244.723  244.649  245.005     252.729  252.842  252.78   252.719
   ⋮                                 ⋱                      ⋮             
 244.184  245.68   245.997  246.456  …  252.421  252.528  252.452  252.637
 244.186  245.649  245.907  246.313     252.518  252.546  252.469  252.643
 244.163  245.542  245.731  246.085     252.561  252.553  252.495  252.637
 244.227  245.491  245.68   246.178     252.643  252.596  252.534  252.678
 244.227  245.483  245.626  245.987     252.692  252.633  252.573  252.672
 244.253  245.442  245.497  245.975  …  252.756  252.682  252.577  252.631
 244.227  245.409  245.352  245.897     252.719  252.758  252.6    252.655
 244.296  245.356  245.231  245.774     252.735  252.809  252.612  252.659
 244.301  245.303  245.192  245.524     252.733  252.862  252.655  252.678</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../storage/">« Storage Backends</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 13 January 2020 15:08">Monday 13 January 2020</span>. Using Julia version 1.1.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
